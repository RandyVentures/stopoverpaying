#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

# Prevent committing .env files
if git diff --cached --name-only | grep -qE "^\.env"; then
  echo "❌ Error: .env files should not be committed!"
  echo "   Found: $(git diff --cached --name-only | grep '^\.env')"
  echo ""
  echo "   To fix:"
  echo "   git reset HEAD .env*"
  exit 1
fi

# Check for potential API keys or secrets in staged files
if git diff --cached | grep -qiE "(api[_-]?key|secret[_-]?key|password|private[_-]?key|token).*=.*['\"][a-zA-Z0-9]{20,}"; then
  echo "⚠️  Warning: Potential secret detected in staged files!"
  echo "   Please review your changes carefully."
  echo ""
  read -p "   Continue anyway? (y/N) " -n 1 -r
  echo
  if [[ ! $REPLY =~ ^[Yy]$ ]]; then
    exit 1
  fi
fi

exit 0
